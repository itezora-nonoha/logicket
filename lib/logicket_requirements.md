# ツェッテルカステンSNSタイムライン風アプリ 要件定義

## 基本仕様
- **プラットフォーム**: Flutter for Web
- **バックエンド**: Firebase (Auth + Firestore + Storage)
- **対応デバイス**: スマートフォン・PC両対応（レスポンシブ）
- **ブレークポイント**: 画面幅による切り替え

## 機能要件

### ノート管理
- マークダウン対応のノート作成・編集・削除
- ノート間リンク機能（`[[ノートID]]`形式）
- バックリンク表示（ノート詳細画面のみ）
- 手動保存方式
- タイトルなし（本文のみ）

### タイムライン表示
- カード型レイアウト
- orderフィールドによる順序管理
- 新規ノート挿入時の位置指定機能
- 挿入位置なし指定時は先頭に追加
- ドラッグ&ドロップによる並び替え（PC: マウス、スマホ: ロングタップ）

### ナビゲーション
- **スマホ**: ボトムナビゲーション
- **PC**: サイドバーナビゲーション
- 画面構成: ホーム・作成・詳細・検索・設定

### 認証・データ管理
- Firebase Authentication（Google + 匿名認証）
- ユーザー別データ分離
- オフライン対応（機能縮小：先頭挿入のみ）

## データ構造

### Firestore設計
```
users/{userId}/
  notes/{noteId}/
    - content: string (markdown)
    - order: double
    - linkedNotes: array<string>
    - createdAt: timestamp
    - updatedAt: timestamp
    - isDeleted: boolean
  
  metadata/
    - totalNotes: number
    - lastOrder: double
```

### 順序管理
- double型orderフィールドで管理
- 最大保持数: 約100万〜1000万ノート
- 必要に応じてリナンバリング実装

## UI/UX要件

### レスポンシブ対応
```
スマホ (< 768px):
- ボトムナビゲーション
- タッチ操作最適化
- カード幅: 画面幅-32px

PC (>= 768px):
- サイドバーナビゲーション  
- マウス操作対応
- カード幅: 最大600px
```

### 挿入位置指定UI
- タイムライン上でカーソル位置指定
- 大量ノート時の検索・スクロール機能
- 視覚的な挿入位置プレビュー

### リンク機能
- `[[]]`記法でノート参照
- 存在しないリンクはダイアログ表示
- バックリンク一覧表示

## 技術制約

### 制限事項
- 画像アップロード機能なし（将来的にFirebase Storage使用予定）
- タイトル機能なし
- 自動保存なし

### オフライン対応
- Firestore offline persistence使用
- オフライン時は挿入位置指定無効
- 先頭挿入のみ許可

## 実装優先度

### Phase 1 (MVP)
1. 基本のノート作成・表示
2. orderフィールドによる順序管理
3. マークダウンレンダリング
4. 認証機能

### Phase 2
1. ノート間リンク機能
2. 挿入位置指定UI
3. レスポンシブ対応

### Phase 3
1. ドラッグ&ドロップ並び替え
2. オフライン対応
3. 検索・フィルター機能